name: Continuous Integration

on:
  push:
    branches:
    - main

  pull_request:
    branches:
    - main

jobs:
  
  test:
      runs-on: ubuntu-22.04

      container:
        image: docker://jbeirer/ubuntu22-fastcalosim:latest

      steps:
      - uses: actions/checkout@v4

      - name: Configure
        run: cmake "--preset=ci-ubuntu"
          -D BUILD_SHARED_LIBS=YES

      - name: Build
        run: cmake --build build --config Release -j 2

      - name: Install
        run: cmake --install build --config Release --prefix prefix

      - name: Test
        working-directory: build
        run: ctest --output-on-failure --no-tests=error -C Release -j 2
